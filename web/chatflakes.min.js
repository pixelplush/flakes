const e="https://api.pixelplush.dev/v1";let a="PixelPlush ChatFlakes",n={},t={},o="",s=1,r=3,l=0,c={},i={};function f(){!function(e,a){g++;let n="particle_"+g,t=Unicorn.AddObject(n,{type:"rectangle",scale:{x:3,y:3},animations:{anim:{framerate:i[e],frames:c[e].slice(),loop:!1}},isStatic:!0,x:a,y:0,z:100});"rainbow"!==e&&"sunrays"!==e&&(t.animations.anim.alpha=.25+.5*Math.random()),t.animations.anim.anchor.set(0),setTimeout((()=>{Unicorn.RemoveObject(n)}),.25*i[e]*c[e].length*1e3)}(`raindrop_${M(3)+1}`,M(1920))}function h(){if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,t.snow,t.leaves&&(Unicorn.Load("leaf_gold",`${o}/assets/game-parachute/autumn_theme/leaf_gold.png`),Unicorn.Load("leaf1",`${o}/assets/game-parachute/autumn_theme/leaf1.png`),Unicorn.Load("leaf2",`${o}/assets/game-parachute/autumn_theme/leaf2.png`),Unicorn.Load("leaf3",`${o}/assets/game-parachute/autumn_theme/leaf3.png`),Unicorn.Load("leaf4",`${o}/assets/game-parachute/autumn_theme/leaf4.png`),Unicorn.Load("leaf5",`${o}/assets/game-parachute/autumn_theme/leaf5.png`),Unicorn.Load("leaf6",`${o}/assets/game-parachute/autumn_theme/leaf6.png`),Unicorn.Load("oak_gold",`${o}/assets/game-parachute/autumn_theme/oak_gold.png`),Unicorn.Load("oak1",`${o}/assets/game-parachute/autumn_theme/oak1.png`),Unicorn.Load("oak2",`${o}/assets/game-parachute/autumn_theme/oak2.png`),Unicorn.Load("oak3",`${o}/assets/game-parachute/autumn_theme/oak3.png`),Unicorn.Load("oak4",`${o}/assets/game-parachute/autumn_theme/oak4.png`),Unicorn.Load("oak5",`${o}/assets/game-parachute/autumn_theme/oak5.png`),Unicorn.Load("oak6",`${o}/assets/game-parachute/autumn_theme/oak6.png`),l>0&&setInterval((()=>{for(let e=0;e<r;e++)w(m[M(m.length)])}),l)),t.snow&&(Unicorn.Load("snowflake1",`${o}/assets/game-parachute/christmas_theme/snowflake_1.png`),Unicorn.Load("snowflake2",`${o}/assets/game-parachute/christmas_theme/snowflake_2.png`),Unicorn.Load("snowflake3",`${o}/assets/game-parachute/christmas_theme/snowflake_3.png`),Unicorn.Load("snowflake4",`${o}/assets/game-parachute/christmas_theme/snowflake_4.png`),Unicorn.Load("snowflake5",`${o}/assets/game-parachute/christmas_theme/snowflake_5.png`),Unicorn.Load("snowflake6",`${o}/assets/game-parachute/christmas_theme/snowflake_6.png`),Unicorn.Load("snowflake7",`${o}/assets/game-parachute/christmas_theme/snowflake_7.png`),l>0&&setInterval((()=>{for(let e=0;e<r;e++)$(u[M(u.length)])}),l)),t.blossoms){for(let e=0;e<12;e++)Unicorn.Load(`blossom${e+1}`,`${o}/assets/game-parachute/spring_theme/petal${e+1}.png`);l>0&&setInterval((()=>{for(let e=0;e<r;e++)U(p[M(p.length)])}),l)}if(t.rain){for(let e=1;e<=3;e++){c[`raindrop_${e}`]=[],i[`raindrop_${e}`]=16/60;for(let a=0;a<10;a++)Unicorn.Load(`raindrop_${e}_${a}`,`${o}/assets/stream-weather/raindrop/raindrop${e}/raindrop${e}_${a+1}.png`),c[`raindrop_${e}`].push(`raindrop_${e}_${a}`)}l>0&&setInterval((()=>{for(let e=0;e<r;e++)f()}),l)}}const m=["leaf1","leaf2","leaf3","leaf4","leaf5","leaf6","oak1","oak2","oak3","oak4","oak5","oak6"],u=["snowflake1","snowflake2","snowflake3","snowflake4","snowflake5","snowflake6","snowflake7"],p=Array.from({length:12},((e,a)=>`blossom${a+1}`));let g=0,d=[],k=[],_=[];function w(e){let a=t.leaves2?M(1080):M(2160)-1080,n=M(10),o="leaf_"+ ++g,s=Unicorn.AddBacklay(o,e,-100,a,{scale:{x:2,y:2}});s.name=o,s.progress=0,s.offset=n,d.push(s)}function $(e){let a=M(10),n="snow_"+ ++g,t=Unicorn.AddBacklay(n,e,M(1920),-100,{scale:{x:2,y:2}});t.name=n,t.progress=0,t.offset=a,k.push(t)}function U(e){let a=M(2160)-1080,n=M(10),t="leaf_"+ ++g,o=Unicorn.AddBacklay(t,e,-100,a,{scale:{x:3,y:3}});o.name=t,o.progress=0,o.offset=n,_.push(o)}function y(e,a){const n=a/1e3;for(let e=0;e<d.length;e++){let a=d[e].progress+=n/10;a>=1?(Unicorn.RemoveBacklay(d[e].name),d.splice(e--,1)):t.leaves2?(d[e].x=2480*Math.sin(a)-100,d[e].y+=Math.sin(20*a+d[e].offset),d[e].angle=10*Math.cos(20*a)+60*d[e].offset):(d[e].x=2480*Math.sin(a)-100,d[e].y+=n/10*1080+d[e].offset/10+Math.sin(20*a+d[e].offset),d[e].angle=10*Math.cos(20*a)+60*d[e].offset)}for(let e=0;e<k.length;e++){let a=k[e].progress+=n/10;a>=1?(Unicorn.RemoveBacklay(k[e].name),k.splice(e--,1)):(k[e].y+=n/10*1180+k[e].offset/10+Math.sin(20*a+k[e].offset),k[e].angle=10*Math.cos(20*a)+60*k[e].offset)}for(let e=0;e<_.length;e++){let a=_[e].progress+=n/10;a>=1?(Unicorn.RemoveBacklay(_[e].name),_.splice(e--,1)):(_[e].x=2480*Math.sin(a)-100,_[e].y+=n/10*1080+_[e].offset/10+Math.sin(20*a+_[e].offset),_[e].angle=10*Math.cos(20*a)+60*_[e].offset)}}function v(e,a,n,o,s){if(o.mod||o.broadcaster||o.vip){if("raindrop"===a){const e=parseInt(n||"10"),a=4;for(let n=0;n<a;n++)for(let n=0;n<e/a;n++)setTimeout((()=>{f()}),150*(n+a)+M(2e3))}if("leaf"===a){const e=parseInt(n||"10"),a=4;for(let n=0;n<a;n++)for(let n=0;n<e/a;n++)setTimeout((()=>{w(m[M(m.length)])}),(t.leaves2?100:150)*(n+a)+M(t.leaves2?100:2e3))}if("snow"===a){const e=parseInt(n||"10"),a=4;for(let n=0;n<a;n++)for(let n=0;n<e/a;n++)setTimeout((()=>{$(u[M(u.length)])}),(t.leaves2?100:150)*(n+a)+M(t.leaves2?100:2e3))}if("blossom"===a){const e=parseInt(n||"10"),a=4;for(let n=0;n<a;n++)for(let n=0;n<e/a;n++)setTimeout((()=>{U(p[M(p.length)])}),150*(n+a)+M(2e3))}}}let L=0;function I(e,a,n,o,l){if(L=(L+1)%s,0===L){if(t.leaves||t.leaves2)for(let e=0;e<r;e++)w(m[M(m.length)]);if(t.snow)for(let e=0;e<r;e++)$(u[M(u.length)]);if(t.blossoms)for(let e=0;e<r;e++)U(p[M(p.length)]);if(t.rain)for(let e=0;e<r;e++)f()}}function M(e){return Math.floor(e*Math.random())}var b="";async function x(){return fetch(`${e}/analytics/heartbeat`,{method:"POST",body:JSON.stringify({session:b,game:"flakes",theme:a,channel:t.channel,players:[t.channel],count:1})}).then((e=>e.json()))}window.setupGame=function(c,i,f){a=c,n=i,t=f,o=n.path||"",s=f.nth||1,r=parseInt(f.num||3),l=parseInt(f.timer||0),async function(){try{const a=(await fetch(`${o}/assets/shamelist.txt`).then((e=>e.text()))).split(",").map((e=>e.trim().toLowerCase()));if(t.channel&&a&&a.includes(t.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),!1),n.requires)try{if(account=await fetch(`${e}/accounts`,{headers:{Twitch:t.oauth?t.oauth.replace("oauth:",""):void 0}}).then((e=>e.json())),console.log(account),account.error)throw"Login Error";if(!account.owned.includes(n.requires))throw"Item not owned"}catch(e){return void console.log("Auth Validate Failed",e)}}catch(e){console.log(e)}Unicorn.Create("unicorn-display",{width:1920,height:1080,background:"transparent",init:h,update:y,channel:t.channel,username:t.oauth?t.channel:void 0,password:t.oauth?t.oauth.replace("oauth:",""):void 0,onCommand:v,onChat:I,gravity:{x:0,y:0}}),ComfyJS.onConnected=async(e,a,n)=>{if(n){let e=await x();0!==e&&(b=e.session,setInterval((()=>{x()}),6e4))}}}()};