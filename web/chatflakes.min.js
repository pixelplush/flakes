let e="PixelPlush ChatFlakes",a={},n={},t="",o=1,s=3,r={},l={};function i(){!function(e,a){p++;let n="particle_"+p,t=Unicorn.AddObject(n,{type:"rectangle",scale:{x:3,y:3},animations:{anim:{framerate:l[e],frames:r[e].slice(),loop:!1}},isStatic:!0,x:a,y:0,z:100});"rainbow"!==e&&"sunrays"!==e&&(t.animations.anim.alpha=.25+.5*Math.random()),t.animations.anim.anchor.set(0),setTimeout((()=>{Unicorn.RemoveObject(n)}),.25*l[e]*r[e].length*1e3)}(`raindrop_${v(3)+1}`,v(1920))}function f(){if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,n.snow&&Unicorn.AddParticles("snowupdown",{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"line",angle:Math.PI/2,startColor:"#ffffff",endColor:"#ffffff",intensity:2,minSpeed:.05,maxSpeed:.2,decay:15},0,-200),n.leaves&&(Unicorn.Load("leaf_gold",`${t}/assets/game-parachute/autumn_theme/leaf_gold.png`),Unicorn.Load("leaf1",`${t}/assets/game-parachute/autumn_theme/leaf1.png`),Unicorn.Load("leaf2",`${t}/assets/game-parachute/autumn_theme/leaf2.png`),Unicorn.Load("leaf3",`${t}/assets/game-parachute/autumn_theme/leaf3.png`),Unicorn.Load("leaf4",`${t}/assets/game-parachute/autumn_theme/leaf4.png`),Unicorn.Load("leaf5",`${t}/assets/game-parachute/autumn_theme/leaf5.png`),Unicorn.Load("leaf6",`${t}/assets/game-parachute/autumn_theme/leaf6.png`),Unicorn.Load("oak_gold",`${t}/assets/game-parachute/autumn_theme/oak_gold.png`),Unicorn.Load("oak1",`${t}/assets/game-parachute/autumn_theme/oak1.png`),Unicorn.Load("oak2",`${t}/assets/game-parachute/autumn_theme/oak2.png`),Unicorn.Load("oak3",`${t}/assets/game-parachute/autumn_theme/oak3.png`),Unicorn.Load("oak4",`${t}/assets/game-parachute/autumn_theme/oak4.png`),Unicorn.Load("oak5",`${t}/assets/game-parachute/autumn_theme/oak5.png`),Unicorn.Load("oak6",`${t}/assets/game-parachute/autumn_theme/oak6.png`)),n.snowflakes&&(Unicorn.Load("snowflake1",`${t}/assets/game-parachute/christmas_theme/snowflake_1.png`),Unicorn.Load("snowflake2",`${t}/assets/game-parachute/christmas_theme/snowflake_2.png`),Unicorn.Load("snowflake3",`${t}/assets/game-parachute/christmas_theme/snowflake_3.png`),Unicorn.Load("snowflake4",`${t}/assets/game-parachute/christmas_theme/snowflake_4.png`),Unicorn.Load("snowflake5",`${t}/assets/game-parachute/christmas_theme/snowflake_5.png`),Unicorn.Load("snowflake6",`${t}/assets/game-parachute/christmas_theme/snowflake_6.png`),Unicorn.Load("snowflake7",`${t}/assets/game-parachute/christmas_theme/snowflake_7.png`)),n.blossoms)for(let e=0;e<12;e++)Unicorn.Load(`blossom${e+1}`,`${t}/assets/game-parachute/spring_theme/petal${e+1}.png`);if(n.rain)for(let e=1;e<=3;e++){r[`raindrop_${e}`]=[],l[`raindrop_${e}`]=16/60;for(let a=0;a<10;a++)Unicorn.Load(`raindrop_${e}_${a}`,`${t}/assets/stream-weather/raindrop/raindrop${e}/raindrop${e}_${a+1}.png`),r[`raindrop_${e}`].push(`raindrop_${e}_${a}`)}}const c=["leaf1","leaf2","leaf3","leaf4","leaf5","leaf6","oak1","oak2","oak3","oak4","oak5","oak6"],h=["snowflake1","snowflake2","snowflake3","snowflake4","snowflake5","snowflake6","snowflake7"],m=Array.from({length:12},((e,a)=>`blossom${a+1}`));let p=0,u=[],g=[],d=[];function k(e){let a=n.leaves2?v(1080):v(2160)-1080,t=v(10),o="leaf_"+ ++p,s=Unicorn.AddBacklay(o,e,-100,a,{scale:{x:2,y:2}});s.name=o,s.progress=0,s.offset=t,u.push(s)}function _(e){let a=v(10),n="snow_"+ ++p,t=Unicorn.AddBacklay(n,e,v(1920),-100,{scale:{x:2,y:2}});t.name=n,t.progress=0,t.offset=a,g.push(t)}function w(e){let a=v(2160)-1080,n=v(10),t="leaf_"+ ++p,o=Unicorn.AddBacklay(t,e,-100,a,{scale:{x:3,y:3}});o.name=t,o.progress=0,o.offset=n,d.push(o)}function $(e,a){const t=a/1e3;for(let e=0;e<u.length;e++){let a=u[e].progress+=t/10;a>=1?(Unicorn.RemoveBacklay(u[e].name),u.splice(e--,1)):n.leaves2?(u[e].x=2480*Math.sin(a)-100,u[e].y+=Math.sin(20*a+u[e].offset),u[e].angle=10*Math.cos(20*a)+60*u[e].offset):(u[e].x=2480*Math.sin(a)-100,u[e].y+=t/10*1080+u[e].offset/10+Math.sin(20*a+u[e].offset),u[e].angle=10*Math.cos(20*a)+60*u[e].offset)}for(let e=0;e<g.length;e++){let a=g[e].progress+=t/10;a>=1?(Unicorn.RemoveBacklay(g[e].name),g.splice(e--,1)):(g[e].y+=t/10*1180+g[e].offset/10+Math.sin(20*a+g[e].offset),g[e].angle=10*Math.cos(20*a)+60*g[e].offset)}for(let e=0;e<d.length;e++){let a=d[e].progress+=t/10;a>=1?(Unicorn.RemoveBacklay(d[e].name),d.splice(e--,1)):(d[e].x=2480*Math.sin(a)-100,d[e].y+=t/10*1080+d[e].offset/10+Math.sin(20*a+d[e].offset),d[e].angle=10*Math.cos(20*a)+60*d[e].offset)}}function U(e,a,t,o,s){if(o.mod||o.broadcaster||o.vip){if("raindrop"===a){const e=parseInt(t||"10"),a=4;for(let n=0;n<a;n++)for(let n=0;n<e/a;n++)setTimeout((()=>{i()}),150*(n+a)+v(2e3))}if("leaf"===a){const e=parseInt(t||"10"),a=4;for(let t=0;t<a;t++)for(let t=0;t<e/a;t++)setTimeout((()=>{k(c[v(c.length)])}),(n.leaves2?100:150)*(t+a)+v(n.leaves2?100:2e3))}if("snow"===a){const e=parseInt(t||"10"),a=4;for(let t=0;t<a;t++)for(let t=0;t<e/a;t++)setTimeout((()=>{_(h[v(h.length)])}),(n.leaves2?100:150)*(t+a)+v(n.leaves2?100:2e3))}if("blossom"===a){const e=parseInt(t||"10"),a=4;for(let n=0;n<a;n++)for(let n=0;n<e/a;n++)setTimeout((()=>{w(m[v(m.length)])}),150*(n+a)+v(2e3))}}}let y=0;function L(e,a,t,r,l){if(y=(y+1)%o,0===y){if(n.leaves||n.leaves2)for(let e=0;e<s;e++)k(c[v(c.length)]);if(n.snowflakes)for(let e=0;e<s;e++)_(h[v(h.length)]);if(n.blossoms)for(let e=0;e<s;e++)w(m[v(m.length)]);if(n.rain)for(let e=0;e<s;e++)i()}}function v(e){return Math.floor(e*Math.random())}var M="";async function b(){return fetch("http://localhost:3000/v1/analytics/heartbeat",{method:"POST",body:JSON.stringify({session:M,game:"flakes",theme:e,channel:n.channel,players:[n.channel],count:1})}).then((e=>e.json()))}window.setupGame=function(r,l,i){e=r,a=l,n=i,t=a.path||"",o=i.nth||1,s=parseInt(i.num||3),async function(){try{const e=(await fetch(`${t}/assets/shamelist.txt`).then((e=>e.text()))).split(",").map((e=>e.trim().toLowerCase()));n.channel&&e&&e.includes(n.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),!1)}catch(e){console.log(e)}Unicorn.Create("unicorn-display",{width:1920,height:1080,background:"transparent",init:f,update:$,channel:n.channel,username:n.oauth?n.channel:void 0,password:n.oauth?n.oauth.replace("oauth:",""):void 0,onCommand:U,onChat:L,gravity:{x:0,y:0}}),ComfyJS.onConnected=async(e,a,n)=>{if(n){let e=await b();0!==e&&(M=e.session,setInterval((()=>{b()}),6e4))}}}()};