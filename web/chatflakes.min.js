let e="PixelPlush ChatFlakes",a={},n={},t="",s=1,o={},r={};function l(){!function(e,a){m++;let n="particle_"+m,t=Unicorn.AddObject(n,{type:"rectangle",scale:{x:3,y:3},animations:{anim:{framerate:r[e],frames:o[e].slice(),loop:!1}},isStatic:!0,x:a,y:0,z:100});"rainbow"!==e&&"sunrays"!==e&&(t.animations.anim.alpha=.25+.5*Math.random()),t.animations.anim.anchor.set(0),setTimeout((()=>{Unicorn.RemoveObject(n)}),.25*r[e]*o[e].length*1e3)}(`raindrop_${L(3)+1}`,L(1920))}function c(){if(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST,n.snow&&Unicorn.AddParticles("snowupdown",{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"line",angle:Math.PI/2,startColor:"#ffffff",endColor:"#ffffff",intensity:2,minSpeed:.05,maxSpeed:.2,decay:15},0,-200),n.leaves&&(Unicorn.Load("leaf_gold",`${t}/assets/game-parachute/autumn_theme/leaf_gold.png`),Unicorn.Load("leaf1",`${t}/assets/game-parachute/autumn_theme/leaf1.png`),Unicorn.Load("leaf2",`${t}/assets/game-parachute/autumn_theme/leaf2.png`),Unicorn.Load("leaf3",`${t}/assets/game-parachute/autumn_theme/leaf3.png`),Unicorn.Load("leaf4",`${t}/assets/game-parachute/autumn_theme/leaf4.png`),Unicorn.Load("leaf5",`${t}/assets/game-parachute/autumn_theme/leaf5.png`),Unicorn.Load("leaf6",`${t}/assets/game-parachute/autumn_theme/leaf6.png`),Unicorn.Load("oak_gold",`${t}/assets/game-parachute/autumn_theme/oak_gold.png`),Unicorn.Load("oak1",`${t}/assets/game-parachute/autumn_theme/oak1.png`),Unicorn.Load("oak2",`${t}/assets/game-parachute/autumn_theme/oak2.png`),Unicorn.Load("oak3",`${t}/assets/game-parachute/autumn_theme/oak3.png`),Unicorn.Load("oak4",`${t}/assets/game-parachute/autumn_theme/oak4.png`),Unicorn.Load("oak5",`${t}/assets/game-parachute/autumn_theme/oak5.png`),Unicorn.Load("oak6",`${t}/assets/game-parachute/autumn_theme/oak6.png`)),n.snowflakes&&(Unicorn.Load("snowflake1",`${t}/assets/game-parachute/christmas_theme/snowflake_1.png`),Unicorn.Load("snowflake2",`${t}/assets/game-parachute/christmas_theme/snowflake_2.png`),Unicorn.Load("snowflake3",`${t}/assets/game-parachute/christmas_theme/snowflake_3.png`),Unicorn.Load("snowflake4",`${t}/assets/game-parachute/christmas_theme/snowflake_4.png`),Unicorn.Load("snowflake5",`${t}/assets/game-parachute/christmas_theme/snowflake_5.png`),Unicorn.Load("snowflake6",`${t}/assets/game-parachute/christmas_theme/snowflake_6.png`),Unicorn.Load("snowflake7",`${t}/assets/game-parachute/christmas_theme/snowflake_7.png`)),n.blossoms)for(let e=0;e<12;e++)Unicorn.Load(`blossom${e+1}`,`${t}/assets/game-parachute/spring_theme/petal${e+1}.png`);if(n.rain)for(let e=1;e<=3;e++){o[`raindrop_${e}`]=[],r[`raindrop_${e}`]=16/60;for(let a=0;a<10;a++)Unicorn.Load(`raindrop_${e}_${a}`,`${t}/assets/stream-weather/raindrop/raindrop${e}/raindrop${e}_${a+1}.png`),o[`raindrop_${e}`].push(`raindrop_${e}_${a}`)}}const i=["leaf1","leaf2","leaf3","leaf4","leaf5","leaf6","oak1","oak2","oak3","oak4","oak5","oak6"],f=["snowflake1","snowflake2","snowflake3","snowflake4","snowflake5","snowflake6","snowflake7"],h=Array.from({length:12},((e,a)=>`blossom${a+1}`));let m=0,p=[],u=[],g=[];function d(e){let a=n.leaves2?L(1080):L(2160)-1080,t=L(10),s="leaf_"+ ++m,o=Unicorn.AddBacklay(s,e,-100,a,{scale:{x:2,y:2}});o.name=s,o.progress=0,o.offset=t,p.push(o)}function k(e){let a=L(10),n="snow_"+ ++m,t=Unicorn.AddBacklay(n,e,L(1920),-100,{scale:{x:2,y:2}});t.name=n,t.progress=0,t.offset=a,u.push(t)}function _(e){let a=L(2160)-1080,n=L(10),t="leaf_"+ ++m,s=Unicorn.AddBacklay(t,e,-100,a,{scale:{x:3,y:3}});s.name=t,s.progress=0,s.offset=n,g.push(s)}function w(e,a){const t=a/1e3;for(let e=0;e<p.length;e++){let a=p[e].progress+=t/10;a>=1?(Unicorn.RemoveBacklay(p[e].name),p.splice(e--,1)):n.leaves2?(p[e].x=2480*Math.sin(a)-100,p[e].y+=Math.sin(20*a+p[e].offset),p[e].angle=10*Math.cos(20*a)+60*p[e].offset):(p[e].x=2480*Math.sin(a)-100,p[e].y+=t/10*1080+p[e].offset/10+Math.sin(20*a+p[e].offset),p[e].angle=10*Math.cos(20*a)+60*p[e].offset)}for(let e=0;e<u.length;e++){let a=u[e].progress+=t/10;a>=1?(Unicorn.RemoveBacklay(u[e].name),u.splice(e--,1)):(u[e].y+=t/10*1180+u[e].offset/10+Math.sin(20*a+u[e].offset),u[e].angle=10*Math.cos(20*a)+60*u[e].offset)}for(let e=0;e<g.length;e++){let a=g[e].progress+=t/10;a>=1?(Unicorn.RemoveBacklay(g[e].name),g.splice(e--,1)):(g[e].x=2480*Math.sin(a)-100,g[e].y+=t/10*1080+g[e].offset/10+Math.sin(20*a+g[e].offset),g[e].angle=10*Math.cos(20*a)+60*g[e].offset)}}function $(e,a,t,s,o){if(s.mod||s.broadcaster||s.vip){if("raindrop"===a){const e=parseInt(t||"10"),a=4;for(let n=0;n<a;n++)for(let n=0;n<e/a;n++)setTimeout((()=>{l()}),150*(n+a)+L(2e3))}if("leaf"===a){const e=parseInt(t||"10"),a=4;for(let t=0;t<a;t++)for(let t=0;t<e/a;t++)setTimeout((()=>{d(i[L(i.length)])}),(n.leaves2?100:150)*(t+a)+L(n.leaves2?100:2e3))}if("snow"===a){const e=parseInt(t||"10"),a=4;for(let t=0;t<a;t++)for(let t=0;t<e/a;t++)setTimeout((()=>{k(f[L(f.length)])}),(n.leaves2?100:150)*(t+a)+L(n.leaves2?100:2e3))}if("blossom"===a){const e=parseInt(t||"10"),a=4;for(let n=0;n<a;n++)for(let n=0;n<e/a;n++)setTimeout((()=>{_(h[L(h.length)])}),150*(n+a)+L(2e3))}}}let U=0;function y(e,a,t,o,r){U=(U+1)%s,0===U&&((n.leaves||n.leaves2)&&d(i[L(i.length)]),n.snowflakes&&k(f[L(f.length)]),n.blossoms&&_(h[L(h.length)]),n.rain&&l())}function L(e){return Math.floor(e*Math.random())}var v="";async function M(){return fetch("http://localhost:3000/v1/analytics/heartbeat",{method:"POST",body:JSON.stringify({session:v,game:"flakes",theme:e,channel:n.channel,players:[n.channel],count:1})}).then((e=>e.json()))}window.setupGame=function(o,r,l){e=o,a=r,n=l,t=a.path||"",s=l.nth||1,async function(){try{const e=(await fetch(`${t}/assets/shamelist.txt`).then((e=>e.text()))).split(",").map((e=>e.trim().toLowerCase()));n.channel&&e&&e.includes(n.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),!1)}catch(e){console.log(e)}Unicorn.Create("unicorn-display",{width:1920,height:1080,background:"transparent",init:c,update:w,channel:n.channel,username:n.oauth?n.channel:void 0,password:n.oauth?n.oauth.replace("oauth:",""):void 0,onCommand:$,onChat:y,gravity:{x:0,y:0}}),ComfyJS.onConnected=async(e,a,n)=>{if(n){let e=await M();0!==e&&(v=e.session,setInterval((()=>{M()}),6e4))}}}()};